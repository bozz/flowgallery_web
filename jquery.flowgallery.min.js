/*!
* Refactored version for easier use
* version 0.6.5r (25-OCT-2013)
* Refactoring by: Robin Tenhagen
* The code can be found at: https://github.com/stratege1988/flowgallery
*
* Original Version:
* jQuery flowGallery plugin: Cover Flow Image Gallery
* Examples and documentation at: http://github.com/bozz/flowGallery
* version 0.6.5 (04-NOV-2012)
* Author: Boris Searles (boris@lucidgardens.com)
* Requires jQuery v1.3.2 or later
* Dual licensed under the MIT and GPL licenses:
* http://www.opensource.org/licenses/mit-license.php
* http://www.gnu.org/licenses/gpl.html
*/$.fn.flowGallery=function(w){flowgallery=new FlowGallery;flowgallery.setOptions($.extend({},$.fn.flowGallery.defaults,w));this.each(function(c){flowgallery._initList(this)});return flowgallery};
$.fn.flowGallery.defaults={activeIndex:0,animate:!0,circular:!1,enableKeyNavigation:!0,forwardOnActiveClick:!1,forceWidth:!1,forceHeight:!1,backgroundColor:"black",thumbWidth:"auto",onClickFunc:null,thumbHeight:"auto",thumbTopOffset:"auto",imagePadding:4,thumbPadding:3,loadingClass:"loading",easing:"linear",duration:900};
var FlowGallery=function(){var w,c,m,y,l,n,r,p,v,q,d,b={},z=!1;this.setOptions=function(a){b=a};this.getOptions=function(){return b};this._initList=function(a){c=w=0;l=y=m=!1;v=p=r=n=0;q=null;d=[];l=a;q=$(l).css({listStyle:"none",overflow:"hidden",marginLeft:"0",paddingLeft:"0",position:"relative",width:"100%"}).parent();b.circular&&(_children=$(l).children(),_children.clone().prependTo(l),_children.clone().appendTo(l),b.activeIndex+=_children.length);a=document.createElement("div");var h=document.createElement("p");
$(h).addClass("bf-caption").css({backgroundColor:b.backgroundColor,display:"none",marginTop:"0",padding:"8px "+(b.imagePadding+10)+"px 15px",position:"absolute"});$(a).addClass("bf-wrapper").css({position:"relative"}).append(l).append(h);q.append(a);$(window).resize(function(){n=q.width();p=.5*n;t();A(m)});var k=!1;$(l).children().each(function(a){var h=$(this).find("img");b.forceWidth&&h.width(b.forceWidth);var f=B(h.get(0)),g=C(h,f);d.push(g);G(h,a);a===c&&f&&(k=g.h);$(this).css({backgroundColor:b.backgroundColor,
position:"absolute",textAlign:"center"}).find("img").css({cursor:"pointer",height:"100%",imageRendering:"optimizeQuality",width:"100%"});m||b.activeIndex!==a||($(this).addClass("active"),m=this,c=a);w++});n=q.width();p=.5*n;v=k?"auto"===b.thumbTopOffset?.5*k:b.thumbTopOffset:"auto"===b.thumbTopOffset?.5*r:b.thumbTopOffset+.5*b.thumbHeight;!0===b.enableKeyNavigation&&$(document).unbind("keydown",D).keydown(D);t()};var D=function(a){37===a.keyCode?u(-1):39===a.keyCode&&u(1)},t=function(a){var h=!0,
k=null,e=function(){A(m);q.width()!==n&&(n=q.width(),p=.5*n,t(),A(m))},x={};$(l).children().each(function(f){if($(this).hasClass("active"))x={left:p-b.imagePadding-.5*d[f].w+"px",top:"0",width:d[f].w+"px",height:d[f].h+"px",padding:b.imagePadding+"px"},h=!1,k=e;else{var g=p;if(h)for(g-=.5*d[c].w,g-=b.imagePadding,g-=10*(c-f),g-=2*(c-f)*b.thumbPadding,i=f;i<c;i++)g-=d[i].tw;else for(g+=.5*d[c].w,g+=b.imagePadding,g+=10*(f-c),g+=2*(f-c)*b.thumbPadding,i=c+1;i<f;i++)g+=d[i].tw;x={left:g+"px",top:v-.5*
d[f].th+"px",width:d[f].tw+"px",height:d[f].th+"px",padding:b.thumbPadding+"px"};k=null}a?$(this).stop().animate(x,{duration:b.duration,easing:b.easing,complete:k}):($(this).css(x),k&&k())})},A=function(a){var h=$(a).find("img").get(0);if(!B(h))return!1;a=$(a).parent().parent().find("p.bf-caption");var k=h.title;0<h.title.length&&(a.html(k),a.css({left:p-b.imagePadding-.5*d[c].w,top:d[c].h+2*b.imagePadding,width:d[c].w-20}),h=$(l).height()+a.height()+40,$(l).parent().height(h),a.fadeIn("fast"))},
C=function(a,h){var c,e,d,f=0;h?(e=a.get(0),"undefined"!==typeof e.naturalWidth?(c=b.forceWidth||e.naturalWidth||e.width,e=b.forceHeight||e.naturalHeight||e.height):(e=new Image,e.src=a.attr("src"),c=e.width,e=e.height)):(c=a.attr("width"),e=a.attr("height"));"auto"===b.thumbWidth&&"auto"==b.thumbHeight?(d=100,f=Math.round(100*e/c)):"auto"===b.thumbHeight?(d=b.thumbWidth,f=Math.round(e*Number(b.thumbWidth)/c)):(d="auto"===b.thumbWidth?Math.round(c*Number(b.thumbHeight)/e):b.thumbWidth,f=b.thumbHeight);
e>r&&(r=e,r+=2*b.imagePadding,$(l).height(r));return{h:e,w:c,th:f,tw:d}},B=function(a){return b.forceWidth&&b.forceHeight||a.width>b.thumbWidth&&20<a.height?!0:!a.complete||"undefined"!==typeof a.naturalWidth&&0===a.naturalWidth?!1:!0},G=function(a,c){a.hide().parent().addClass(b.loadingClass).css({height:d[c].th,width:d[c].tw});var k=function(e){if(this.complete||"complete"===this.readyState&&"readystatechange"===e.type){$(this).css("visibility","visible").parent().removeClass(b.loadingClass);$(this).fadeIn();
var f=C(a,!0);d[c]=f;c===b.activeIndex?(y=!0,v="auto"===b.thumbTopOffset?.5*f.h:b.thumbTopOffset,e&&t()):(e={height:f.th},y&&(e.top=v-.5*d[c].th+"px"),a.parent().animate(e));H(a.parent())}},e=a.get(0);e.complete?k.call(e):a.bind("load readystatechange",k).bind("error",function(){$(this).css("visibility","visible").parent().removeClass(b.loadingClass)})},I=function(){$("p.bf-caption").hide();_currentIndex=c;c=0;m=this;$(this).parent().children().each(function(a){m===this&&(c=a)});E(_currentIndex);
t(b.animate)};this.getActiveIndex=function(){return c};this.getLength=function(){return d.length};this.jump=function(a){u(a-c);return this};this.next=function(a){u(1);return this};this.prev=function(a){u(-1);return this};var J=function(){z=!1},H=function(a){$(a).click(function(){if(!z)if(z=!0,window.setTimeout(J.bind(this),80),this!==m)I.bind(this).call();else if(!0===b.forwardOnActiveClick)u(1);else if(null!=b.onClickFunc)return b.onClickFunc()})},u=function(a){var h=c,k=c+a;if(0>a&&0<=k)c=k;else if(0<
a&&k<d.length)c=k;else return!1;_currentIndex=h;m=$(l).children().get(c);E(_currentIndex);t(b.animate)},F=function(a,b){var d=c;c=a+b;m=$(l).children().get(c);$(l).find(".active").removeClass("active");$(m).addClass("active");t(!1);c=d+b;m=$(l).children().get(c)},E=function(a){if(b.circular){var d=$(l).children().length/3;a>c?c<d&&F(a,d):c>2*d-1&&F(a,-d)}$("p.bf-caption").hide();$(l).find(".active").removeClass("active");$(m).addClass("active");n=q.width();p=.5*n}};